<!DOCTYPE html>
<html>
<head>
  <title>Airbnb Chatbot</title>
  <style>
    body { font-family: Arial; background: #f0f4f8; }
    #chatbox { width: 400px; margin: 50px auto; padding: 10px; border-radius: 12px; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .msg { padding: 8px 12px; margin: 6px 0; border-radius: 10px; max-width: 80%; }
    .user { background: #007bff; color: white; margin-left: auto; }
    .bot { background: #e5e5ea; color: black; margin-right: auto; }
  </style>
</head>
<body>
  <div id="chatbox">
    <div id="messages"></div>
    <input id="userInput" type="text" placeholder="Type your message..." style="width: 80%">
    <button onclick="handleSend()">Send</button>
  </div>

  <script>
    async function sendMessageToN8N(userMessage) {
      const response = await fetch("https://n8n.bmvsi.in/webhook/airbnb-bot", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: userMessage })
      });

      // Try to read response
      try {
        const data = await response.json();
        return data.reply || "No reply received.";
      } catch (err) {
        return "⚠️ Error connecting to bot.";
      }
    }

    async function handleSend() {
      const input = document.getElementById("userInput");
      const userMessage = input.value;
      input.value = "";

      // Show user message
      document.getElementById("messages").innerHTML += `<div class="msg user">${userMessage}</div>`;

      // Send to n8n
      const botReply = await sendMessageToN8N(userMessage);

      // Show bot reply
      document.getElementById("messages").innerHTML += `<div class="msg bot">${botReply}</div>`;
    }
  </script>
</body>
</html>
